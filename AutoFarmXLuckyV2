loadstring((function(b64) local chars = 'ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/'; local result = ''; local val = 0; local valb = -8; for i = 1, #b64 do local c = b64:sub(i,i); if c ~= '=' then local pos = chars:find(c) - 1; val = val * 64 + pos; valb = valb + 6; if valb >= 0 then result = result .. string.char(math.floor(val / 2^valb) % 256); val = val % 2^valb; valb = valb - 8; end; end; end; return result; end)("cmVwZWF0IHRhc2sud2FpdCgpIHVudGlsIGdhbWU6SXNMb2FkZWQoKSBhbmQgZ2FtZS5QbGF5ZXJzLkxvY2FsUGxheWVyIGFuZCBnYW1lLlBsYXllcnMuTG9jYWxQbGF5ZXIuQ2hhcmFjdGVyCgpsb2NhbCBQbGF5ZXJzID0gZ2FtZTpHZXRTZXJ2aWNlKCJQbGF5ZXJzIikKbG9jYWwgUmVwbGljYXRlZFN0b3JhZ2UgPSBnYW1lOkdldFNlcnZpY2UoIlJlcGxpY2F0ZWRTdG9yYWdlIikKbG9jYWwgVGVsZXBvcnRTZXJ2aWNlID0gZ2FtZTpHZXRTZXJ2aWNlKCJUZWxlcG9ydFNlcnZpY2UiKQpsb2NhbCBIdHRwU2VydmljZSA9IGdhbWU6R2V0U2VydmljZSgiSHR0cFNlcnZpY2UiKQoKbG9jYWwgUGxheWVyID0gUGxheWVycy5Mb2NhbFBsYXllcgpsb2NhbCBDaGFyYWN0ZXIgPSBQbGF5ZXIuQ2hhcmFjdGVyIG9yIFBsYXllci5DaGFyYWN0ZXJBZGRlZDpXYWl0KCkKbG9jYWwgSFJQID0gQ2hhcmFjdGVyOldhaXRGb3JDaGlsZCgiSHVtYW5vaWRSb290UGFydCIpCmxvY2FsIEh1bWFub2lkID0gQ2hhcmFjdGVyOldhaXRGb3JDaGlsZCgiSHVtYW5vaWQiKQoKaWYgbm90IFBsYXllci5QbGF5ZXJHdWk6RmluZEZpcnN0Q2hpbGQoIkhVRCIpIHRoZW4KICAgIGxvY2FsIEhVRCA9IFJlcGxpY2F0ZWRTdG9yYWdlLk9iamVjdHMuSFVEOkNsb25lKCkKICAgIEhVRC5QYXJlbnQgPSBQbGF5ZXIuUGxheWVyR3VpCmVuZAoKaWYgUGxheWVyLlBsYXllckd1aTpGaW5kRmlyc3RDaGlsZCgiTG9hZGluZ1NjcmVlbjEiKSB0aGVuCiAgICBQbGF5ZXIuUGxheWVyR3VpOkZpbmRGaXJzdENoaWxkKCJMb2FkaW5nU2NyZWVuMSIpOkRlc3Ryb3koKQplbmQKCmlmIFBsYXllci5QbGF5ZXJHdWk6RmluZEZpcnN0Q2hpbGQoIkxvYWRpbmdTY3JlZW4iKSB0aGVuCiAgICBQbGF5ZXIuUGxheWVyR3VpOkZpbmRGaXJzdENoaWxkKCJMb2FkaW5nU2NyZWVuIik6RGVzdHJveSgpCmVuZAoKaWYgQ2hhcmFjdGVyOkZpbmRGaXJzdENoaWxkKCJSZW1vdGVFdmVudCIpIHRoZW4KICAgIENoYXJhY3Rlci5SZW1vdGVFdmVudDpGaXJlU2VydmVyKCJQcmVzc2VkUGxheSIpCmVuZAoKZ2V0Z2VudigpLlN0dWZmID0gewogICAgVGVsZXBvcnRCeXBhc3MgPSB0cnVlLAogICAgSXRlbU1hZ25pdHVkZUJ5cGFzcyA9IHRydWUsCiAgICBDcmFzaEJ5cGFzcyA9IHRydWUsCiAgICBBdXRvRmFybSA9IHRydWUsCiAgICBBdXRvU2VsbCA9IHRydWUsCiAgICBQdXJjaGFzZUx1Y2t5ID0gdHJ1ZQp9Cgpsb2NhbCBibGFja2xpc3QgPSB7IkRpc2MiLCJCb25lIiwiQXJtIiwiVW1icmVsbGEiLCJTY3l0aGUiLCJTY3l0aCIsIlBsdWNrIiwiTGlnaCIsIlRlYSIsIkJvdyIsIktvaWNoaSIsIlJlcXVpZW0iLCJCYWJ5IiwiUmVkZW1tZWQiLCJMdWNreSIsIkx1Y2sifQoKbG9jYWwgZnVuY3Rpb24gaXNCbGFja2xpc3RlZCh0b29sTmFtZSkKICAgIGZvciBfLHdvcmQgaW4gaXBhaXJzKGJsYWNrbGlzdCkgZG8KICAgICAgICBpZiBzdHJpbmcuZmluZCh0b29sTmFtZSwgd29yZCkgdGhlbgogICAgICAgICAgICByZXR1cm4gdHJ1ZQogICAgICAgIGVuZAogICAgZW5kCiAgICByZXR1cm4gZmFsc2UKZW5kCgpsb2NhbCBmdW5jdGlvbiBUZWxlcG9ydEJ5cGFzcygpCiAgICBpZiBnZXRnZW52KCkuU3R1ZmYuVGVsZXBvcnRCeXBhc3MgdGhlbgogICAgICAgIGxvY2FsIE9sZE5hbWVjYWxsVFAKICAgICAgICBPbGROYW1lY2FsbFRQID0gaG9va21ldGFtZXRob2QoZ2FtZSwgIl9fbmFtZWNhbGwiLCBmdW5jdGlvbihzZWxmLCAuLi4pCiAgICAgICAgICAgIGxvY2FsIGFyZ3MgPSB7Li4ufQogICAgICAgICAgICBsb2NhbCBtZXRob2QgPSBnZXRuYW1lY2FsbG1ldGhvZCgpCiAgICAgICAgICAgIGlmIG1ldGhvZCA9PSAiSW52b2tlU2VydmVyIiBhbmQgYXJnc1sxXSA9PSAiaWRrbG9sYnJhaDJkZSIgdGhlbgogICAgICAgICAgICAgICAgcmV0dXJuICIgIF9fX1hQIERFIEtFWSIKICAgICAgICAgICAgZW5kCiAgICAgICAgICAgIHJldHVybiBPbGROYW1lY2FsbFRQKHNlbGYsIC4uLikKICAgICAgICBlbmQpCiAgICBlbmQKZW5kCgpsb2NhbCBmdW5jdGlvbiBJdGVtTWFnbml0dWRlQnlwYXNzKCkKICAgIGlmIGdldGdlbnYoKS5TdHVmZi5JdGVtTWFnbml0dWRlQnlwYXNzIHRoZW4KICAgICAgICBsb2NhbCBPbGRJbmRleEl0ZW0KICAgICAgICBPbGRJbmRleEl0ZW0gPSBob29rbWV0YW1ldGhvZChQbGF5ZXIuQ2hhcmFjdGVyLlByaW1hcnlQYXJ0LlBvc2l0aW9uLCAiX19pbmRleCIsIGZ1bmN0aW9uKHNlbGYsIGtleSkKICAgICAgICAgICAgaWYgbm90IGNoZWNrY2FsbGVyKCkgYW5kIGtleTpsb3dlcigpID09ICJtYWduaXR1ZGUiIGFuZCBnZXRjYWxsaW5nc2NyaXB0KCkuTmFtZSA9PSAiSXRlbVNwYXduIiB0aGVuCiAgICAgICAgICAgICAgICByZXR1cm4gMAogICAgICAgICAgICBlbmQKICAgICAgICAgICAgcmV0dXJuIE9sZEluZGV4SXRlbShzZWxmLCBrZXkpCiAgICAgICAgZW5kKQogICAgZW5kCmVuZAoKbG9jYWwgZnVuY3Rpb24gQ3Jhc2hCeXBhc3MoKQogICAgaWYgZ2V0Z2VudigpLlN0dWZmLkNyYXNoQnlwYXNzIHRoZW4KICAgICAgICBsb2NhbCBGdW5jdGlvbkxpYnJhcnkgPSByZXF1aXJlKFJlcGxpY2F0ZWRTdG9yYWdlOldhaXRGb3JDaGlsZCgiTW9kdWxlcyIpLkZ1bmN0aW9uTGlicmFyeSkKICAgICAgICBsb2NhbCBPbGRQY2FsbCA9IEZ1bmN0aW9uTGlicmFyeS5wY2FsbAogICAgICAgIEZ1bmN0aW9uTGlicmFyeS5wY2FsbCA9IGZ1bmN0aW9uKC4uLikKICAgICAgICAgICAgbG9jYWwgZiA9IC4uLgogICAgICAgICAgICBpZiB0eXBlKGYpID09ICJmdW5jdGlvbiIgYW5kICNnZXR1cHZhbHVlcyhmKSA9PSAxMSB0aGVuCiAgICAgICAgICAgICAgICByZXR1cm4KICAgICAgICAgICAgZW5kCiAgICAgICAgICAgIHJldHVybiBPbGRQY2FsbCguLi4pCiAgICAgICAgZW5kCiAgICBlbmQKZW5kCgpsb2NhbCBmdW5jdGlvbiBSYW5kb21FcXVpcFRvb2woKQogICAgc3Bhd24oZnVuY3Rpb24oKQogICAgICAgIHdoaWxlIGdldGdlbnYoKS5TdHVmZi5BdXRvRmFybSBhbmQgQ2hhcmFjdGVyIGFuZCBIdW1hbm9pZCBkbwogICAgICAgICAgICBsb2NhbCBCYWNrcGFjayA9IFBsYXllcjpGaW5kRmlyc3RDaGlsZCgiQmFja3BhY2siKQogICAgICAgICAgICBpZiBCYWNrcGFjayB0aGVuCiAgICAgICAgICAgICAgICBsb2NhbCB0b29scyA9IHt9CiAgICAgICAgICAgICAgICBmb3IgXyx2IGluIGlwYWlycyhCYWNrcGFjazpHZXRDaGlsZHJlbigpKSBkbwogICAgICAgICAgICAgICAgICAgIGlmIHY6SXNBKCJUb29sIikgYW5kIG5vdCBpc0JsYWNrbGlzdGVkKHYuTmFtZSkgdGhlbgogICAgICAgICAgICAgICAgICAgICAgICB0YWJsZS5pbnNlcnQodG9vbHMsdikKICAgICAgICAgICAgICAgICAgICBlbmQKICAgICAgICAgICAgICAgIGVuZAogICAgICAgICAgICAgICAgaWYgI3Rvb2xzPjAgdGhlbgogICAgICAgICAgICAgICAgICAgIGxvY2FsIHRvb2wgPSB0b29sc1ttYXRoLnJhbmRvbSgxLCN0b29scyldCiAgICAgICAgICAgICAgICAgICAgcGNhbGwoZnVuY3Rpb24oKQogICAgICAgICAgICAgICAgICAgICAgICBIdW1hbm9pZDpFcXVpcFRvb2wodG9vbCkKICAgICAgICAgICAgICAgICAgICBlbmQpCiAgICAgICAgICAgICAgICBlbmQKICAgICAgICAgICAgZW5kCiAgICAgICAgICAgIHRhc2sud2FpdCgxKQogICAgICAgIGVuZAogICAgZW5kKQplbmQKCmxvY2FsIGZ1bmN0aW9uIEF1dG9TZWxsKCkKICAgIHNwYXduKGZ1bmN0aW9uKCkKICAgICAgICB3aGlsZSBnZXRnZW52KCkuU3R1ZmYuQXV0b1NlbGwgZG8KICAgICAgICAgICAgbG9jYWwgTGl2aW5nID0gd29ya3NwYWNlOkZpbmRGaXJzdENoaWxkKCJMaXZpbmciKQogICAgICAgICAgICBpZiBMaXZpbmcgdGhlbgogICAgICAgICAgICAgICAgbG9jYWwgVGFyZ2V0ID0gTGl2aW5nOkZpbmRGaXJzdENoaWxkKFBsYXllci5OYW1lKQogICAgICAgICAgICAgICAgaWYgVGFyZ2V0IHRoZW4KICAgICAgICAgICAgICAgICAgICBsb2NhbCBFdmVudCA9IFRhcmdldDpGaW5kRmlyc3RDaGlsZCgiUmVtb3RlRXZlbnQiKQogICAgICAgICAgICAgICAgICAgIGlmIEV2ZW50IHRoZW4KICAgICAgICAgICAgICAgICAgICAgICAgcGNhbGwoZnVuY3Rpb24oKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgRXZlbnQ6RmlyZVNlcnZlcigiRW5kRGlhbG9ndWUiLCB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgTlBDID0gIk1lcmNoYW50IiwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBPcHRpb24gPSAiT3B0aW9uMiIsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgRGlhbG9ndWUgPSAiRGlhbG9ndWU1IgogICAgICAgICAgICAgICAgICAgICAgICAgICAgfSkKICAgICAgICAgICAgICAgICAgICAgICAgZW5kKQogICAgICAgICAgICAgICAgICAgIGVuZAogICAgICAgICAgICAgICAgZW5kCiAgICAgICAgICAgIGVuZAogICAgICAgICAgICB0YXNrLndhaXQoMC44KQogICAgICAgIGVuZAogICAgZW5kKQplbmQKCmxvY2FsIENvbmZpZyA9IHsKICAgIE1heFN0b3JlID0gMjYwMCwKICAgIENoZWNrSW50ZXJ2YWwgPSA0LAogICAgVGVsZXBvcnRJbnRlcnZhbCA9IDIsCn0KCmxvY2FsIGZ1bmN0aW9uIFNlcnZlckhvcCgpCiAgICB0YXNrLndhaXQoMikKICAgIGxvY2FsIFBsYWNlSWQgPSBnYW1lLlBsYWNlSWQKICAgIGxvY2FsIEpvYklkID0gZ2FtZS5Kb2JJZAogICAgbG9jYWwgUm9vdEZvbGRlciA9ICJTZXJ2ZXJIb3AiCiAgICBsb2NhbCBTdG9yYWdlRmlsZSA9IFJvb3RGb2xkZXIgLi4gIi8iIC4uIHRvc3RyaW5nKFBsYWNlSWQpIC4uICIuanNvbiIKICAgIGxvY2FsIERhdGEgPSB7CiAgICAgICAgU3RhcnQgPSB0aWNrKCksCiAgICAgICAgSm9icyA9IHt9LAogICAgfQogICAgaWYgbm90IGlzZm9sZGVyKFJvb3RGb2xkZXIpIHRoZW4KICAgICAgICBtYWtlZm9sZGVyKFJvb3RGb2xkZXIpCiAgICBlbmQKICAgIGlmIGlzZmlsZShTdG9yYWdlRmlsZSkgdGhlbgogICAgICAgIGxvY2FsIG9rLCBOZXdEYXRhID0gcGNhbGwoZnVuY3Rpb24oKQogICAgICAgICAgICByZXR1cm4gSHR0cFNlcnZpY2U6SlNPTkRlY29kZShyZWFkZmlsZShTdG9yYWdlRmlsZSkpCiAgICAgICAgZW5kKQogICAgICAgIGlmIG9rIGFuZCBOZXdEYXRhIGFuZCB0aWNrKCkgLSBOZXdEYXRhLlN0YXJ0IDwgQ29uZmlnLk1heFN0b3JlIHRoZW4KICAgICAgICAgICAgRGF0YSA9IE5ld0RhdGEKICAgICAgICBlbmQKICAgIGVuZAogICAgaWYgbm90IHRhYmxlLmZpbmQoRGF0YS5Kb2JzLCBKb2JJZCkgdGhlbgogICAgICAgIHRhYmxlLmluc2VydChEYXRhLkpvYnMsIEpvYklkKQogICAgZW5kCiAgICB3cml0ZWZpbGUoU3RvcmFnZUZpbGUsIEh0dHBTZXJ2aWNlOkpTT05FbmNvZGUoRGF0YSkpCiAgICBsb2NhbCBTZXJ2ZXJzID0ge30KICAgIGxvY2FsIEN1cnNvciA9ICIiCiAgICB3aGlsZSB0cnVlIGRvCiAgICAgICAgbG9jYWwgdXJsID0gKCJodHRwczovL2dhbWVzLnJvYmxveC5jb20vdjEvZ2FtZXMvJWQvc2VydmVycy9QdWJsaWM/c29ydE9yZGVyPURlc2MmbGltaXQ9MTAwJmV4Y2x1ZGVGdWxsR2FtZXM9dHJ1ZSZjdXJzb3I9JXMiKTpmb3JtYXQoUGxhY2VJZCwgQ3Vyc29yKQogICAgICAgIGxvY2FsIHN1Y2Nlc3MsIHJlc3BvbnNlID0gcGNhbGwoZnVuY3Rpb24oKQogICAgICAgICAgICByZXR1cm4gZ2FtZTpIdHRwR2V0KHVybCkKICAgICAgICBlbmQpCiAgICAgICAgaWYgc3VjY2VzcyB0aGVuCiAgICAgICAgICAgIGxvY2FsIGRlY29kZVN1Y2Nlc3MsIGJvZHkgPSBwY2FsbChmdW5jdGlvbigpCiAgICAgICAgICAgICAgICByZXR1cm4gSHR0cFNlcnZpY2U6SlNPTkRlY29kZShyZXNwb25zZSkKICAgICAgICAgICAgZW5kKQogICAgICAgICAgICBpZiBkZWNvZGVTdWNjZXNzIGFuZCBib2R5IGFuZCBib2R5LmRhdGEgdGhlbgogICAgICAgICAgICAgICAgZm9yIF8sIHNlcnZlciBpbiBpcGFpcnMoYm9keS5kYXRhKSBkbwogICAgICAgICAgICAgICAgICAgIGlmIHR5cGUoc2VydmVyKSA9PSAidGFibGUiCiAgICAgICAgICAgICAgICAgICAgICAgIGFuZCBzZXJ2ZXIuaWQKICAgICAgICAgICAgICAgICAgICAgICAgYW5kIHRvbnVtYmVyKHNlcnZlci5wbGF5aW5nKQogICAgICAgICAgICAgICAgICAgICAgICBhbmQgdG9udW1iZXIoc2VydmVyLm1heFBsYXllcnMpCiAgICAgICAgICAgICAgICAgICAgICAgIGFuZCBzZXJ2ZXIucGxheWluZyA8IHNlcnZlci5tYXhQbGF5ZXJzCiAgICAgICAgICAgICAgICAgICAgICAgIGFuZCBub3QgdGFibGUuZmluZChEYXRhLkpvYnMsIHNlcnZlci5pZCkgdGhlbgogICAgICAgICAgICAgICAgICAgICAgICB0YWJsZS5pbnNlcnQoU2VydmVycywgc2VydmVyLmlkKQogICAgICAgICAgICAgICAgICAgIGVuZAogICAgICAgICAgICAgICAgZW5kCiAgICAgICAgICAgICAgICBDdXJzb3IgPSBib2R5Lm5leHRQYWdlQ3Vyc29yIG9yIG5pbAogICAgICAgICAgICAgICAgaWYgbm90IEN1cnNvciB0aGVuIGJyZWFrIGVuZAogICAgICAgICAgICBlbHNlCiAgICAgICAgICAgICAgICBicmVhawogICAgICAgICAgICBlbmQKICAgICAgICBlbHNlCiAgICAgICAgICAgIGJyZWFrCiAgICAgICAgZW5kCiAgICAgICAgdGFzay53YWl0KENvbmZpZy5DaGVja0ludGVydmFsKQogICAgZW5kCiAgICBpZiAjU2VydmVycyA+IDAgdGhlbgogICAgICAgIFRlbGVwb3J0U2VydmljZTpUZWxlcG9ydFRvUGxhY2VJbnN0YW5jZShQbGFjZUlkLCBTZXJ2ZXJzW21hdGgucmFuZG9tKDEsICNTZXJ2ZXJzKV0sIFBsYXllcikKICAgIGVsc2UKICAgICAgICBUZWxlcG9ydFNlcnZpY2U6VGVsZXBvcnQoUGxhY2VJZCwgUGxheWVyKQogICAgZW5kCmVuZApnZXRnZW52KCkuU2VydmVySG9wID0gU2VydmVySG9wCgpsb2NhbCBmdW5jdGlvbiBmaW5kSXRlbShpdGVtTmFtZSkKICAgIGxvY2FsIEl0ZW1zRGljdCA9IHsKICAgICAgICBbIlBvc2l0aW9uIl0gPSB7fSwKICAgICAgICBbIlByb3hpbWl0eVByb21wdCJdID0ge30sCiAgICAgICAgWyJJdGVtcyJdID0ge30KICAgIH0KICAgIGZvciBfLGl0ZW0gaW4gcGFpcnMod29ya3NwYWNlLkl0ZW1fU3Bhd25zLkl0ZW1zOkdldENoaWxkcmVuKCkpIGRvCiAgICAgICAgaWYgaXRlbTpGaW5kRmlyc3RDaGlsZCgiTWVzaFBhcnQiKSBhbmQgaXRlbS5Qcm94aW1pdHlQcm9tcHQuT2JqZWN0VGV4dCA9PSBpdGVtTmFtZSB0aGVuCiAgICAgICAgICAgIGlmIGl0ZW0uUHJveGltaXR5UHJvbXB0Lk1heEFjdGl2YXRpb25EaXN0YW5jZSA9PSA4IHRoZW4KICAgICAgICAgICAgICAgIHRhYmxlLmluc2VydChJdGVtc0RpY3RbIkl0ZW1zIl0sIGl0ZW0uUHJveGltaXR5UHJvbXB0Lk9iamVjdFRleHQpCiAgICAgICAgICAgICAgICB0YWJsZS5pbnNlcnQoSXRlbXNEaWN0WyJQcm94aW1pdHlQcm9tcHQiXSwgaXRlbS5Qcm94aW1pdHlQcm9tcHQpCiAgICAgICAgICAgICAgICB0YWJsZS5pbnNlcnQoSXRlbXNEaWN0WyJQb3NpdGlvbiJdLCBpdGVtLk1lc2hQYXJ0LkNGcmFtZSkKICAgICAgICAgICAgZW5kCiAgICAgICAgZW5kCiAgICBlbmQKICAgIHJldHVybiBJdGVtc0RpY3QKZW5kCgpsb2NhbCBmdW5jdGlvbiBBdXRvRmFybUl0ZW1zKCkKICAgIHNwYXduKGZ1bmN0aW9uKCkKICAgICAgICB3aGlsZSBnZXRnZW52KCkuU3R1ZmYuQXV0b0Zhcm0gYW5kIENoYXJhY3RlciBhbmQgSFJQIGRvCiAgICAgICAgICAgIGxvY2FsIGl0ZW1zID0gd29ya3NwYWNlLkl0ZW1fU3Bhd25zLkl0ZW1zOkdldENoaWxkcmVuKCkKICAgICAgICAgICAgZm9yIF8sIEl0ZW0gaW4gcGFpcnMoaXRlbXMpIGRvCiAgICAgICAgICAgICAgICBpZiBJdGVtOklzQSgiTW9kZWwiKSB0aGVuCiAgICAgICAgICAgICAgICAgICAgSFJQLkNGcmFtZSA9IEl0ZW0uUHJpbWFyeVBhcnQuQ0ZyYW1lICsgVmVjdG9yMy5uZXcoMCwgMywgMCkKICAgICAgICAgICAgICAgICAgICB0YXNrLndhaXQoMSkKICAgICAgICAgICAgICAgICAgICBsb2NhbCBQcm9tcHQgPSBJdGVtOkZpbmRGaXJzdENoaWxkT2ZDbGFzcygiUHJveGltaXR5UHJvbXB0IikKICAgICAgICAgICAgICAgICAgICBpZiBQcm9tcHQgdGhlbgogICAgICAgICAgICAgICAgICAgICAgICBmaXJlcHJveGltaXR5cHJvbXB0KFByb21wdCkKICAgICAgICAgICAgICAgICAgICAgICAgdGFzay53YWl0KDAuOCkKICAgICAgICAgICAgICAgICAgICBlbmQKICAgICAgICAgICAgICAgIGVuZAogICAgICAgICAgICBlbmQKICAgICAgICAgICAgdGFzay53YWl0KDAuMSkKICAgICAgICBlbmQKICAgIGVuZCkKZW5kCgpsb2NhbCBmdW5jdGlvbiBDb3VudEx1Y2t5QXJyb3dzKCkKICAgIGxvY2FsIGNvdW50ID0gMAogICAgbG9jYWwgQmFja3BhY2sgPSBQbGF5ZXI6RmluZEZpcnN0Q2hpbGQoIkJhY2twYWNrIikKICAgIGlmIEJhY2twYWNrIHRoZW4KICAgICAgICBmb3IgXywgdG9vbCBpbiBpcGFpcnMoQmFja3BhY2s6R2V0Q2hpbGRyZW4oKSkgZG8KICAgICAgICAgICAgaWYgdG9vbDpJc0EoIlRvb2wiKSBhbmQgdG9vbC5OYW1lID09ICJMdWNreSBBcnJvdyIgdGhlbgogICAgICAgICAgICAgICAgY291bnQgKz0gMQogICAgICAgICAgICBlbmQKICAgICAgICBlbmQKICAgIGVuZAogICAgcmV0dXJuIGNvdW50CmVuZAoKbG9jYWwgZnVuY3Rpb24gQXV0b1B1cmNoYXNlTHVja3lBcnJvdygpCiAgICBzcGF3bihmdW5jdGlvbigpCiAgICAgICAgd2hpbGUgZ2V0Z2VudigpLlN0dWZmLlB1cmNoYXNlTHVja3kgZG8KICAgICAgICAgICAgaWYgQ291bnRMdWNreUFycm93cygpIDwgOSB0aGVuCiAgICAgICAgICAgICAgICBsb2NhbCBMaXZpbmcgPSB3b3Jrc3BhY2U6RmluZEZpcnN0Q2hpbGQoIkxpdmluZyIpCiAgICAgICAgICAgICAgICBpZiBMaXZpbmcgdGhlbgogICAgICAgICAgICAgICAgICAgIGxvY2FsIFRhcmdldCA9IExpdmluZzpGaW5kRmlyc3RDaGlsZChQbGF5ZXIuTmFtZSkKICAgICAgICAgICAgICAgICAgICBpZiBUYXJnZXQgdGhlbgogICAgICAgICAgICAgICAgICAgICAgICBsb2NhbCBFdmVudCA9IFRhcmdldDpGaW5kRmlyc3RDaGlsZCgiUmVtb3RlRXZlbnQiKQogICAgICAgICAgICAgICAgICAgICAgICBpZiBFdmVudCB0aGVuCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBFdmVudDpGaXJlU2VydmVyKCJQdXJjaGFzZVNob3BJdGVtIiwgeyBbIkl0ZW1OYW1lIl0gPSAiMXggTHVja3kgQXJyb3ciIH0pCiAgICAgICAgICAgICAgICAgICAgICAgIGVuZAogICAgICAgICAgICAgICAgICAgIGVuZAogICAgICAgICAgICAgICAgZW5kCiAgICAgICAgICAgIGVuZAogICAgICAgICAgICB0YXNrLndhaXQoMSkKICAgICAgICBlbmQKICAgIGVuZCkKZW5kCgpzcGF3bihmdW5jdGlvbigpCiAgICB3aGlsZSB0cnVlIGRvCiAgICAgICAgaWYgZ2V0Z2VudigpLlN0dWZmLkF1dG9GYXJtIGFuZCBDaGFyYWN0ZXIgYW5kIEhSUCB0aGVuCiAgICAgICAgICAgIGxvY2FsIGl0ZW1zID0gd29ya3NwYWNlLkl0ZW1fU3Bhd25zLkl0ZW1zOkdldENoaWxkcmVuKCkKICAgICAgICAgICAgbG9jYWwgbW9kZWxDb3VudCA9IDAKICAgICAgICAgICAgZm9yIF8sIGl0ZW0gaW4gcGFpcnMoaXRlbXMpIGRvCiAgICAgICAgICAgICAgICBpZiBpdGVtOklzQSgiTW9kZWwiKSB0aGVuCiAgICAgICAgICAgICAgICAgICAgbW9kZWxDb3VudCArPSAxCiAgICAgICAgICAgICAgICBlbmQKICAgICAgICAgICAgZW5kCiAgICAgICAgICAgIGlmIG1vZGVsQ291bnQgPD0gMSB0aGVuCiAgICAgICAgICAgICAgICBIUlAuQ0ZyYW1lID0gQ0ZyYW1lLm5ldygyOTgsIC0zMywgMTY1KQogICAgICAgICAgICAgICAgZm9yIGk9MCwyIGRvCiAgICAgICAgICAgICAgICAgICAgdGFzay53YWl0KDEuNSkKICAgICAgICAgICAgICAgIGVuZAogICAgICAgICAgICAgICAgZ2V0Z2VudigpLlNlcnZlckhvcCgpCiAgICAgICAgICAgICAgICBicmVhawogICAgICAgICAgICBlbmQKICAgICAgICBlbmQKICAgICAgICB0YXNrLndhaXQoMC41KQogICAgZW5kCmVuZCkKClRlbGVwb3J0QnlwYXNzKCkKSXRlbU1hZ25pdHVkZUJ5cGFzcygpCkNyYXNoQnlwYXNzKCkKQXV0b0Zhcm1JdGVtcygpClJhbmRvbUVxdWlwVG9vbCgpCkF1dG9TZWxsKCkKQXV0b1B1cmNoYXNlTHVja3lBcnJvdygpCgpQbGF5ZXIuQ2hhcmFjdGVyQWRkZWQ6Q29ubmVjdChmdW5jdGlvbihuZXdDaGFyKQogICAgQ2hhcmFjdGVyID0gbmV3Q2hhcgogICAgSFJQID0gbmV3Q2hhcjpXYWl0Rm9yQ2hpbGQoIkh1bWFub2lkUm9vdFBhcnQiKQogICAgSHVtYW5vaWQgPSBuZXdDaGFyOldhaXRGb3JDaGlsZCgiSHVtYW5vaWQiKQogICAgdGFzay53YWl0KDMpCiAgICBBdXRvRmFybUl0ZW1zKCkKICAgIFJhbmRvbUVxdWlwVG9vbCgpCiAgICBBdXRvU2VsbCgpCiAgICBBdXRvUHVyY2hhc2VMdWNreUFycm93KCkKICAgIGlmIG5ld0NoYXI6RmluZEZpcnN0Q2hpbGQoIlJlbW90ZUV2ZW50IikgdGhlbgogICAgICAgIG5ld0NoYXIuUmVtb3RlRXZlbnQ6RmlyZVNlcnZlcigiUHJlc3NlZFBsYXkiKQogICAgZW5kCmVuZCk="))()
